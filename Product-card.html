<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/breadcrumb.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/footer.css">
    <link rel="stylesheet" href="./css/root.css">
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
    rel="stylesheet"
    />
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
    rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
    
</head>
    <style>
    body{
    font-family:  sans-serif;
    padding: 20px;
    background-color: var(--color-white);
    }
    .page-content {
    padding-top: 120px; 
    }

.main_countainer_form {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem auto;
    padding: 3rem;
    max-width: 600px;
    border-radius: 1rem;
    background: var(--color-primary);
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}
.main-form {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;

}

.main-form input,
.main-form select {
    padding: 0.8rem;
    border: 1px solid transparent;
    border-radius: .6rem;
    font-size: 0.95rem;
    transition: 0.2s ease;
}

.main-form input:focus,
.main-form select:focus {
    border-color: var(--color-accent);
    outline: none;
}
.main_form_btn {
    padding: 0.9rem;
    background: linear-gradient(135deg, #e1c8f4, #8A52C9);
    color: var(--color-white);
    border: none;
    border-radius: .6rem;
    font-weight: 700;
    cursor: pointer;
    transition: 0.2s ease;
}

.main_form_btn:hover {
    background: linear-gradient(135deg, #c79ae9, #6f35b5);
    transform: translateY(-2px);
}

/* =========================
   PRODUCT GRID
========================= */

.main_countainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 2rem;
    margin-top: 3rem;
}

/* =========================
   PRODUCT CARD
========================= */

.main_box {
    background: var(--color-primary);
    border-radius: 1rem;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-bottom: 3rem;
    box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    transition: 0.25s ease;
}

.main_box:hover {
    transform: translateY(-6px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.image_box img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: .8rem;
}

.text_box h2 {
    font-size: 1rem;
    font-weight: 600;
    color: #222;
    margin: 0;
}

.price_box {
    font-size: 1rem;
    font-weight: bold;
    color: #444;
}

.stars {
    color: #facc15;
    font-size: 1rem;
}

/* =========================
   ACTION BUTTONS
========================= */

.action_box {
    display: flex;
    gap: 0.5rem;
}

.delete-btn,
.edit-btn {
    flex: 1;
    padding: 0.5rem;
    border: none;
    border-radius: .5rem;
    font-size: 0.85rem;
    cursor: pointer;
    transition: 0.2s ease;
}

.delete-btn {
    background: #ff6b6b;
    color: white;
}

.delete-btn:hover {
    background: #e63946;
}

.edit-btn {
    background: #20bace;
    color: white;
}

.edit-btn:hover {
    background: #188c9b;
}





</style>


<body>
    <!--------------- header ----------------------->
    <header  id="1"  class="site-header">
        <div class="header-container">
            <!-- left -->
            <div class="header-left">

            <div class="auth-buttons">
                <button class="btn btn-auth">SIGN UP</button>
                <button class="btn btn-auth">LOG IN</button>
            </div>
            <button class="darkmood">
                <i class="ri-moon-line"></i>
            </button>

            <div class="search-group">
                <div class="search-wrapper">
                <div class="search-box" id="search-box">
                    <i class="ri-search-line"></i>
                    <input type="text" placeholder="Search" />
                </div>
                </div>
            </div>
            </div>

            <!-- Center -->
            <nav>
            <ul class="nav-links">
                <li class="nav-items"><a href="#">Home</a></li>
                <li class="nav-items"><a href="#">About us</a></li>
                <li class="nav-items">
                <span>Services <i class="ri-arrow-down-s-line"></i></span>
            <div class="dropdown-box">
                <ul class="dropdown-left">
                    <li class="dropdown-item " data-target="mega1">
                    <a   href="#">Services 1</a>
                    </li>
                    <li class="dropdown-item" data-target="mega2">
                    <a  href="#">Services 2</a>
                    </li>
                    <li class="dropdown-item" data-target="mega3">
                    <a   href="#">Services 3</a>
                    </li>
                </ul>
                <div class="mega-right">
                    <div class="mega-content" id="mega1">
                    <div class="mega-headers">
                        <header>header1 <i class="ri-arrow-right-s-line"></i></header>
                    </div>
                    
                    <ul class="mega-item">
                        <li><a class="line" href="http://127.0.0.1:5500/list.html" target="_blank">To do list</a></li>
                        <li><a class="line" href="http://127.0.0.1:5500/tabel.html">table</a></li>
                        <li><a class="line" href="">Product-card</a></li>
                        <li><a class="line" href="">abc</a></li> 
                    </ul>   
                        <div class="mega-headers">
                        <header>header1 <i class="ri-arrow-right-s-line"></i></header>
                    </div>
                    
                    <ul class="mega-item">
                        <li><a class="line" href="">abc</a></li>
                        <li><a class="line" href="">abc</a></li>
                        <li><a class="line" href="">abc</a></li>
                        <li><a class="line" href="">abc</a></li> 
                    </ul>   
                        
                    
                    </div>
                    
                    
                    <div class="mega-content" id="mega2">
                    <header>header2<i class="ri-arrow-right-s-line"></i></header>
                    <ul class="mega-item">
                        <li><a  class="line" href="">hgf</a></li>
                        <li><a class="line" href="">hgf</a></li>
                        <li><a class="line" href="">hfh</a></li>
                    </ul>
                    </div>

                    <div class="mega-content" id="mega3">
                    <header>header3<i class="ri-arrow-right-s-line"></i></header>
                    <ul class="mega-item">
                        <li><a class="line" href="">abi</a></li>
                        <li><a class="line" href="">abi</a></li>
                        <li><a class="line" href="">abi</a></li>
                    </ul>
                    </div>
                </div>
                </div>
            </li>
            <li class="nav-items"><a href="#">Forms</a></li>  
            </nav>

            <!-- Right -->
            <div class="header-right">
            

            <div class="header-logo">
                <img
                src="./assets/images/purple-flame-logo-2-th.png"
                alt="logo"
                />
            </div>
            </div>
        </div>
    </header>

    <main class="page-content">
    <nav class="breadcrumb-wrapper" aria-label="breadcrumb">
    <ul class="breadcrumb">
        <li><a href="index.html">Home</a></li>
        <li><a href="#">Services</a></li>
        <li class="current">Product-card</li>
    </ul>
    </nav>
<!--------------- product-card ----------------------->
<section>
    <div class="card">
        <div class="main_countainer_form css-selector" id="mainContainer">

            <form action="" class="main-form" id="productForm">

                <!-- Image -->
                <input type="file" id="imageInput" accept="image/*" required>
                <small class="error_msg"></small>

                <!-- Name -->
                <input type="text" id="nameInput" placeholder="name" minlength="3" required>
                <small class="error_msg"></small>

                <!-- Initial Price -->
                <input type="number" id="initialPriceInput" placeholder="initial Price" min="0" required>
                <small class="error_msg"></small>

                <!-- Discount Percent -->
                <input type="number" id="discountPercentInput" placeholder="discount Percent" min="0" max="100" required>
                <small class="error_msg"></small>

                <!-- Sale Price (auto calculated) -->
                <input type="number" id="salePriceInput" placeholder="sale Price (auto)" readonly>
                <small class="error_msg"></small>

                <!-- Discount Start Date (Gregorian) -->
                <input type="date" id="discountStartInput" required>
                <small class="error_msg"></small>

                <!-- Discount End Date (Gregorian) -->
                <input type="date" id="discountEndInput" required>
                <small class="error_msg"></small>

                <!-- Star Dropdown -->
                <select id="starInput" required>
                    <option value="" disabled selected>select star</option>
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
                <small class="error_msg"></small>

                <!-- Submit -->
                <button class="main_form_btn" type="submit">
                    Submit
                </button>
            </form>
        </div>
    </div>

    <!-- Container for Products -->
    <div class="main_countainer">
        <!-- Products will be rendered here dynamically -->
    </div>

</section>

    </main> 
    <!---- footer -->
    <footer id="5" class="site-footer">
        <!--overlay-top -->
        <section  id="5" class="footer-overlay footer-overlay-top">
        <!-- Map -->  
        <div class="footer-location">
        <a
            href="https://www.google.com/maps?q=Valiasr+Tehran"
            target="_blank"
            rel="noopener noreferrer"
            class="map-link"
        >
            <iframe
            src="https://www.google.com/maps?q=Valiasr%20Tehran&output=embed"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </a>
        </div>

        <!-- Company -->
        <div class="footer__col">
        <h4>Company</h4>
            <ul class="footer__links">
            <li><a href="#">About</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Support</a></li>
            <li><a href="#">Careers</a></li>
            </ul>
        </div>
            <div class="footer__col">
        <h4>Company</h4>
            <ul class="footer__links">
            <li><a href="#">About</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Support</a></li>
            <li><a href="#">Careers</a></li>
            </ul>
        </div>
        <!-- Legal -->
        <div class="footer__col">
            <h4>Legal</h4>
            <ul class="footer__links">
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">Privacy Policy</a></li>
            </ul>
        </div>
    <!-- Logo -->
        <div class="footer-logo">
        <img src="./assets/images/purple-flame-logo-2-th.png" alt="">
        </div>
        </section>

        <!--center-box -->
        <section class="footer-center-box"></section>

        <!-- overlay-bottom -->
        <section class="footer-overlay footer-overlay-bottom">
        <p>© All rights reserved</p>
        </section>
    </footer>


    <script src="js/header.js"></script>
<script>
const form = document.getElementById("productForm");
const productContainer = document.querySelector(".main_countainer");

let editProductId = null; // ذخیره‌ی آی‌دی محصولی که در حال ویرایش است

// تابع ساخت کارت محصول
function createProductCard(product) {
    const card = document.createElement("div");
    card.classList.add("main_box");

    card.innerHTML = `
        <div class="image_box">
            <img src="${product.image || './assets/images/default.png'}" alt="${product.name}">
        </div>
        <div class="text_box">
            <h2>${product.name}</h2>
            <p class="price_box">$${product.salePrice.toFixed(2)}</p>
            <p class="price_box" style="text-decoration: line-through; color: gray;">$${product.initialPrice.toFixed(2)}</p>
            <div class="stars">${'⭐'.repeat(product.star)}</div>
        </div>
        <div class="action_box">
            <button class="edit-btn">Edit</button>
            <button class="delete-btn">Delete</button>
        </div>
    `;

    // حذف محصول
    card.querySelector(".delete-btn").addEventListener("click", async () => {
        try {
            await fetch(`http://localhost:4000/products/${product.id}`, {
                method: "DELETE"
            });
            card.remove();
        } catch (err) {
            console.error("Delete error:", err);
        }
    });

    // ویرایش محصول
    card.querySelector(".edit-btn").addEventListener("click", () => {
        editProductId = product.id;
        document.getElementById("nameInput").value = product.name;
        document.getElementById("initialPriceInput").value = product.initialPrice;
        document.getElementById("discountPercentInput").value = product.discountPercent;
        document.getElementById("salePriceInput").value = product.salePrice;
        document.getElementById("discountStartInput").value = product.discountStart;
        document.getElementById("discountEndInput").value = product.discountEnd;
        document.getElementById("starInput").value = product.star;
    });

    productContainer.appendChild(card);
}

// بارگذاری محصولات موجود هنگام لود صفحه
async function loadProducts() {
    try {
        const res = await fetch("http://localhost:4000/products");
        const products = await res.json();
        products.forEach(createProductCard);
    } catch (err) {
        console.error("Load products error:", err);
    }
}
loadProducts();

// تبدیل عکس به Base64
function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = err => reject(err);
    });
}

// ثبت یا به‌روزرسانی محصول
form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const imageInput = document.getElementById("imageInput");
    const nameInput = document.getElementById("nameInput");
    const initialPriceInput = document.getElementById("initialPriceInput");
    const discountPercentInput = document.getElementById("discountPercentInput");
    const discountStartInput = document.getElementById("discountStartInput");
    const discountEndInput = document.getElementById("discountEndInput");
    const starInput = document.getElementById("starInput");

    const initialPrice = Number(initialPriceInput.value);
    const discountPercent = Number(discountPercentInput.value);
    const salePrice = initialPrice - (initialPrice * discountPercent / 100);

    let imageBase64 = "";
    if (imageInput.files[0]) {
        try {
            imageBase64 = await toBase64(imageInput.files[0]);
        } catch (err) {
            console.error("Image conversion error:", err);
            alert("Error converting image ❌");
            return;
        }
    }

    const productData = {
        image: imageBase64 || undefined, // اگر عکس جدید انتخاب نشد، عکس قبلی حفظ شود
        name: nameInput.value,
        initialPrice,
        discountPercent,
        salePrice,
        discountStart: discountStartInput.value,
        discountEnd: discountEndInput.value,
        star: Number(starInput.value),
        updatedAt: new Date().toISOString()
    };

    try {
        if (editProductId) {
            // ویرایش محصول
            const response = await fetch(`http://localhost:4000/products/${editProductId}`, {
                method: "PATCH",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(productData)
            });
            const updatedProduct = await response.json();

            // جایگزینی کارت قبلی
            productContainer.innerHTML = "";
            loadProducts();
            alert("Product updated successfully ✅");
            editProductId = null;
        } else {
            // ثبت محصول جدید
            const response = await fetch("http://localhost:4002/products", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(productData)
            });
            const savedProduct = await response.json();
            createProductCard(savedProduct);
            alert("Product saved successfully ✅");
        }

        form.reset();
    } catch (error) {
        console.error("Error:", error);
        alert("Error saving product ❌");
    }
});
</script>






</body>
</html>